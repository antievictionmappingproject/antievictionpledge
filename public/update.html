<html>
	<head>
		<link rel="stylesheet" type="text/css" href="upload.test.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<!--	<script type="text/javascript" src="js/geojson.min.js"></script>  -->
	</head>
	<body>
		<h2>File Upload Form</h2>
		<form id="target" enctype="multipart/form-data" name="uploadForm"><input id="sampleFile" name="sampleFile" type="file" />
		<div id="dryRunText">Dry Run</div>
		<input id="dryRun" name="dry run" type="checkbox" /> <input id="upload" type="submit" value="Upload" /></form>
		<div class="w_body">
			<div class="warning">
				<p><span style="color: #e6e6fa;">.</span></p>
			</div>
		</div>
		<script type="text/javascript">// <![CDATA[
			$( document ).ready(function() {
				$( "#target" ).submit(function( event ) {
					event.preventDefault();
					var data = new FormData();
					var file = $("#sampleFile")[0].files[0];
					var isDry = $( "#dryRun" ).is(":checked")
					data.append('sampleFile', file);
					data.append('dryRun', isDry);
					$.ajax({
					  type: "POST",
					  url: 'http://displacement-server-env-rtmfzur43y.elasticbeanstalk.com/upload',
					  data: data,
					    cache: false,
					    contentType: false,
					    processData: false,
					  success: function(data) {
						$('.warning').text(data);
						console.log(data);
					  },
					  error: function(data) {
						if (IsJson(data.responseText)) {
							var errors = JSON.parse(data.responseText);
							console.log("errors", errors);
							$('.warning').html("<div class='wlog_header'>Warning log</div>");
							for (var line in errors) {
								var warningMessage = '<ul><li>Line ' + line;
								warningMessage += '<ul>';
								var array = errors[line];
								if (Object.prototype.toString.call( array ) === '[object Array]' )
								{
									for (var i in array) {
										warningMessage += '<li>' + array[i].message + '</li>';
									}
								} else {
									warningMessage += array;
								}
								warningMessage += '</ul></li></ul>';
								$('.warning').append(warningMessage);
							}
						} else {
							$('.warning').text(data.responseText);
						}
					  }
					});
				});
			});
		function IsJson(str) {
		    try {
			JSON.parse(str);
		    } catch (e) {
			return false;
		    }
		    return true;
		}
		
	// ]]></script>
	</body>
</html>
